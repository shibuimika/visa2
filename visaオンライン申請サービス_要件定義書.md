# VISAオンライン申請サービス 要件定義書（Cursor向け・改訂版）

## 1. サービス概要
在日外国人が「在留資格（技人国・特定技能・留学・家族滞在）」に関する申請を、**完全オンラインで簡便かつ安心して行えるWebサービス**。 
freee会社設立のUXを参考に、少数のアンケート回答によって自動で申請フローを分岐。ユーザーは迷わずに必要書類と入力項目を揃えられ、オンライン申請データまでワンストップで生成できる。

👉 Cursor開発を前提とし、AgentプロンプトでUIモックやReactコンポーネントを段階生成可能な構造に整理。

---

## 2. 想定ユーザー
- 日本に滞在する外国人本人、またはその家族
- 在留資格を **更新／変更／取得** したい人（全員オンライン申請）
- 行政書士に依頼せず自分で進めたいユーザー

---

## 3. ユーザー体験（UXシナリオ）
### ステップ1：ユーザー登録
- メール・パスワードでアカウント作成
- 言語選択（日本語／英語／中国語 等）
- 登録後すぐにアンケートへ遷移

### ステップ2：アンケート
- 最大4問で分岐確定
  1. 在留資格（技人国／特定技能1号／特定技能2号／留学／家族滞在）
  2. 手続き種類（更新／変更／取得）
  3. 家族滞在のみ：関係性（配偶者／子ども／その他）
  4. 勤務先・学校の状況（任意）

👉 アンケート完了時点で「必要準備物チェックリスト」と「必須入力カテゴリ」を自動生成。

### ステップ3：準備物チェック
- **システム環境（全員必須）**
  - マイナンバーカード（電子証明書付き）
  - 在留カード
  - ICカードリーダ／対応スマホ
  - JPKIクライアントソフト導入済PC
  - 国内からの安定ネット環境
  - 有効なメールアドレス
- **書類（分岐表示）**
  - 技人国更新 → 在職証明／給与明細／納税証明
  - 留学更新 → 在学証明／成績証明／学費納入証明
  - 家族滞在（配偶者） → 結婚証明／収入証明／住民票
  - 取得（全資格） → 身元保証人情報

👉 ✅ チェックボックス形式。全て揃ったら「入力フォームへ進む」有効化。

### ステップ4：入力フォーム（分岐あり）
- **共通カテゴリ**
  - 基本情報（氏名、国籍、生年月日、住所、電話 等）
  - パスポート情報
  - 在留カード情報（更新・変更時必須）
  - 犯罪歴
  - 在日親族・同居者
  - 証明写真アップロード

- **条件付きカテゴリ**
  - 技人国
    - 更新 → 在職証明、給与明細、納税証明
    - 変更 → 学歴・職歴、卒業証明、雇用契約書、勤務先情報
    - 取得 → 取得理由、在留理由、身元保証人
  - 特定技能1号
    - 更新 → 在職証明、給与明細、支援状況報告書、納税証明
    - 変更／取得 → 評価試験合格証、支援計画書、雇用契約書
    - 取得 → ＋身元保証人
  - 特定技能2号
    - 更新 → 在職証明、給与明細、納税証明
    - 変更／取得 → 実務経験証明 or 技能試験合格証、雇用契約書、所属機関情報
    - 取得 → ＋身元保証人
  - 留学
    - 更新 → 在学証明、成績証明、出席証明、学費納入証明
    - 変更 → 卒業証明、雇用契約書、勤務先情報
    - 取得 → 入学許可、学費納入証明 or 残高証明、身元保証人
  - 家族滞在
    - 更新（配偶者／子／その他） → 関係証明、収入証明、住民票
    - 変更 → 同上＋現資格情報
    - 取得 → 扶養者情報、関係証明、住民票、身元保証人

👉 必須項目は「アンケート × ビザ種類 × 手続き種類 × 関係性」で自動決定。

### ステップ5：確認画面
- 入力内容を一覧表示、修正可能
- ✅ 「オンライン申請データを生成」

### ステップ6：完了画面
- PDF申請書ダウンロード
- 出入国在留管理庁オンラインポータルへの提出手順ガイド
- 行政書士相談オプション

---

## 4. 動作イメージ（Cursor Agent利用視点）
1. ユーザーが登録→アンケート回答すると、Agentにより「準備物チェック画面」が自動生成される
2. チェック完了後、条件分岐に基づき「必要フォームカテゴリ」だけがUI表示される
3. 入力途中で必須チェックやQ&Aが即時表示（Cursorでバリデーションコード自動生成可能）
4. 確認画面でまとめ、完了画面でPDFとオンライン提出案内を出力

---

## 5. 画面遷移
```mermaid
flowchart TD
  A[ユーザー登録] --> B[アンケート]
  B --> C1[準備物チェック(システム環境)]
  C1 --> C2[準備物チェック(書類カテゴリ別)]
  C2 --> D[入力フォーム(共通+分岐必須)]
  D --> E[確認画面]
  E --> F[完了・提出案内]
```

---

## 6. 入力フォーム分岐ルールまとめ
- **更新** → 現資格＋在職／在学証明、納税証明
- **変更** → 希望資格／期間、学歴・職歴、雇用契約書
- **取得** → 取得理由、在留理由、身元保証人
- **家族滞在** → 属性ごとに関係証明、収入証明、住民票

---

## 7. 非機能要件
- 多言語対応（日本語／英語／中国語）
- モバイル・PC両対応
- リアルタイムバリデーション（Cursor AgentでReact Hooks対応）
- TLS通信、暗号化保管

---

## 8. ユーザー価値
- **数問アンケート→自分専用フロー生成**
- **準備物が明確（システム環境＋書類）**
- **必要な入力のみ表示**で迷わない
- **即時バリデーション＆Q&A**で安心
- **PDFとオンライン提出**で申請完了まで一気通貫

👉 Cursorにとっては、各フェーズをコンポーネント化・分岐条件を明記した設計なので、Agentに分担させて順次開発しやすい。

