# VISA申請サービス開発計画書

## 1. プロジェクト概要

### 目標
在日外国人向けVISA申請サービスを段階的に開発し、freeeのUXを参考にした直感的で使いやすいWebアプリケーションを構築する。

### 技術スタック
- **フロントエンド**: React 18 + TypeScript + Tailwind CSS
- **状態管理**: Zustand（軽量で分かりやすい）
- **ルーティング**: React Router v6
- **バリデーション**: React Hook Form + Zod
- **UI コンポーネント**: Headless UI + 自作コンポーネント
- **多言語対応**: react-i18next
- **デプロイ**: GitHub → Netlify

---

## 2. 開発段階とスケジュール

### 第1段階：基盤構築（Week 1-2）
**目標**: ユーザーが登録からアンケートまで完了できる状態

#### 2.1 開発環境セットアップ
- [ ] Reactプロジェクト作成
- [ ] TypeScript設定
- [ ] Tailwind CSS導入
- [ ] ルーティング設定
- [ ] 基本的なフォルダ構成

#### 2.2 認証システム
- [ ] ユーザー登録フォーム
- [ ] ログイン/ログアウト機能
- [ ] セッション管理（LocalStorageベース）
- [ ] 言語選択機能（日本語/英語/中国語）

#### 2.3 アンケート機能
- [ ] 4問のアンケートフォーム
  - 在留資格選択
  - 手続き種類選択  
  - 家族滞在の関係性（条件付き表示）
  - 勤務先・学校状況（任意）
- [ ] 条件分岐ロジック基盤
- [ ] アンケート結果保存

**成果物**: ユーザー登録→言語選択→アンケート→結果保存の基本フロー

---

### 第2段階：分岐システム実装（Week 3-4）
**目標**: アンケート結果に基づく動的画面表示

#### 2.4 条件分岐エンジン
```typescript
// 分岐条件の型定義
interface UserCondition {
  visaType: 'engineer' | 'specific-1' | 'specific-2' | 'student' | 'family'
  procedureType: 'renewal' | 'change' | 'acquisition'
  familyRelation?: 'spouse' | 'child' | 'other'
  workStatus?: string
}

// 必要項目決定ロジック
const determineRequirements = (condition: UserCondition) => {
  // 条件に基づく必要項目の決定
}
```

#### 2.5 準備物チェック画面
- [ ] システム環境チェックリスト
  - マイナンバーカード
  - 在留カード
  - ICカードリーダー
  - JPKIクライアントソフト
  - 安定ネット環境
  - メールアドレス
- [ ] 書類チェックリスト（分岐表示）
- [ ] チェック状況管理
- [ ] 「入力フォームへ進む」ボタン制御

**成果物**: アンケート結果→条件分岐→個別化された準備物表示

---

### 第3段階：入力フォーム（Week 5-7）
**目標**: 条件に応じた入力フォームの完成

#### 3.1 共通カテゴリ実装（最優先）
- [ ] 基本情報入力
  - 氏名（英語・日本語）
  - 国籍・生年月日
  - 住所・電話番号
- [ ] パスポート情報
- [ ] 在留カード情報
- [ ] 犯罪歴入力
- [ ] 在日親族・同居者情報
- [ ] 証明写真アップロード

#### 3.2 条件付きカテゴリ実装（段階的）
**Week 5**: 技人国関連
- [ ] 更新：在職証明、給与明細、納税証明
- [ ] 変更：学歴・職歴、卒業証明、雇用契約書
- [ ] 取得：取得理由、身元保証人

**Week 6**: 留学・特定技能関連
- [ ] 留学：在学証明、成績証明、学費納入証明
- [ ] 特定技能：評価試験合格証、支援計画書

**Week 7**: 家族滞在関連
- [ ] 関係証明、収入証明、住民票

#### 3.3 バリデーション実装
- [ ] リアルタイム入力チェック
- [ ] 必須項目制御
- [ ] エラーメッセージ表示

**成果物**: 全ての条件分岐に対応した入力フォーム

---

### 第4段階：完了機能（Week 8）
**目標**: 申請データ生成とユーザー完了体験

#### 4.1 確認画面
- [ ] 入力内容一覧表示
- [ ] カテゴリ別整理表示
- [ ] 修正機能（各セクションへの戻り）
- [ ] 最終確認チェックボックス

#### 4.2 完了・提出機能
- [ ] PDF申請書生成（基本版）
- [ ] ダウンロード機能
- [ ] 出入国在留管理庁への提出手順ガイド
- [ ] 申請完了メール送信

**成果物**: 完全なユーザー体験フロー

---

### 第5段階：品質向上（Week 9-10）
**目標**: UX改善と安定性向上

#### 5.1 UX改善
- [ ] プログレスバー表示
- [ ] ローディング状態管理
- [ ] エラーハンドリング改善
- [ ] レスポンシブ対応最適化

#### 5.2 多言語対応完全版
- [ ] 全テキストの多言語化
- [ ] エラーメッセージの多言語対応
- [ ] ヘルプテキストの多言語化

#### 5.3 テスト・最適化
- [ ] 全分岐パターンのテスト
- [ ] パフォーマンス最適化
- [ ] セキュリティ対策

**成果物**: 本番リリース可能な完成版

---

## 3. 混乱を避けるための開発ルール

### 3.1 コード構成
```
src/
├── components/
│   ├── common/          # 共通コンポーネント
│   ├── auth/           # 認証関連
│   ├── survey/         # アンケート
│   ├── checklist/      # 準備物チェック
│   └── forms/          # 入力フォーム
├── hooks/              # カスタムフック
├── stores/             # Zustand状態管理
├── utils/              # ユーティリティ
├── types/              # TypeScript型定義
└── constants/          # 定数
```

### 3.2 状態管理戦略
```typescript
// メインの状態構造
interface AppState {
  user: UserInfo
  survey: SurveyAnswers
  requirements: RequirementList
  formData: FormData
  ui: UIState
}
```

### 3.3 開発方針
1. **1つの機能ずつ完成**: 次の機能に移る前に現在の機能を完全に動作させる
2. **型安全性重視**: TypeScriptの恩恵を最大限活用
3. **コンポーネント分離**: 再利用可能な小さなコンポーネントに分割
4. **テスト駆動**: 重要な分岐ロジックは必ずテストを作成

### 3.4 Git戦略
- `main`: 本番用ブランチ
- `develop`: 開発用ブランチ
- `feature/*`: 機能別ブランチ
- 各段階完了時にdevelopにマージ、テスト後mainにマージ

---

## 4. リスク管理

### 4.1 技術的リスク
- **条件分岐の複雑化**: 早期に分岐ロジックを抽象化
- **状態管理の複雑化**: Zustandの適切な設計で対応
- **パフォーマンス問題**: 段階的最適化で対応

### 4.2 スケジュールリスク
- **機能の肥大化**: MVPに集中し、追加機能は後回し
- **品質問題**: 各段階での十分なテストを実施

---

## 5. 成功指標

### 5.1 技術的指標
- [ ] 全ての分岐パターンが正常動作
- [ ] モバイル・PC両対応
- [ ] 多言語対応完全実装
- [ ] エラー率5%以下

### 5.2 UX指標
- [ ] アンケートから申請書生成まで30分以内
- [ ] ユーザーの迷いを最小限に抑制
- [ ] freeeと同等の直感的操作性

この計画書に従って開発を進めることで、混乱を最小限に抑えながら高品質なVISA申請サービスを構築できます。
